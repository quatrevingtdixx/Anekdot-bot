name: ü§ñ Publish Anekdot

on:
  # üëá –≠–¢–ê –°–¢–†–û–ö–ê –î–ê–Å–¢ –ö–ù–û–ü–ö–£ "RUN WORKFLOW"!
  workflow_dispatch:
    inputs:
      note:
        description: '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–ø—É—Å–∫—É'
        required: false
        default: '–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫'
  
  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 12:00 UTC (15:00 –ú–°–ö)
  schedule:
    - cron: '0 12 * * *'

jobs:
  publish-anekdot:
    runs-on: ubuntu-latest
    
    steps:
    # 1. –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    - name: üì• Checkout code
      uses: actions/checkout@v4
    
    # 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python
    - name: üêç Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    # 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
    - name: üì¶ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install python-telegram-bot
    
    # 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
    - name: ü§ñ Run Telegram Bot
      env:
        BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
        CHANNEL_ID: ${{ secrets.CHANNEL_ID }}
        MY_CHAT_ID: ${{ secrets.MY_CHAT_ID }}
      run: |
        echo "üöÄ –ó–∞–ø—É—Å–∫–∞—é Telegram –±–æ—Ç–∞..."
        echo "üìÖ –î–∞—Ç–∞: $(date '+%d.%m.%Y %H:%M –ú–°–ö')"
        python bot.py
    
    # 5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ –±–æ—Ç –æ–±–Ω–æ–≤–∏–ª —Ñ–∞–π–ª—ã)
    - name: üíæ Commit changes if needed
      run: |
        # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å git
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        if git diff --quiet; then
          echo "‚úÖ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è"
        else
          echo "üìù –°–æ—Ö—Ä–∞–Ω—è—é –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
          git add .
          git commit -m "ü§ñ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –∞–Ω–µ–∫–¥–æ—Ç [–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏]"
          git push
          echo "‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!"
        fi
