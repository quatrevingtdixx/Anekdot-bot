name: Publish Daily Joke

on:
  # –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (—ç—Ç–æ –≤–∞–∂–Ω–æ!)
  workflow_dispatch:
    inputs:
      manual_trigger:
        description: '–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∞–Ω–µ–∫–¥–æ—Ç–∞'
        required: false
        default: 'manual'
  
  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 12:00 UTC (15:00 –ú–°–ö)
  schedule:
    - cron: '0 12 * * *'

jobs:
  publish-joke:
    runs-on: ubuntu-latest
    
    steps:
    # 1. –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    - name: üì• Checkout repository
      uses: actions/checkout@v4
    
    # 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python
    - name: üêç Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    # 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    - name: üì¶ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install python-telegram-bot
    
    # 4. –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    - name: ü§ñ Run Telegram Bot
      env:
        BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
        CHANNEL_ID: ${{ secrets.CHANNEL_ID }}
        MY_CHAT_ID: ${{ secrets.MY_CHAT_ID }}
      run: |
        echo "–ù–∞—á–∏–Ω–∞—é –ø—É–±–ª–∏–∫–∞—Ü–∏—é –∞–Ω–µ–∫–¥–æ—Ç–∞..."
        python bot.py
    
    # 5. –ö–æ–º–º–∏—Ç–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ –±–æ—Ç –∏–∑–º–µ–Ω–∏–ª —Ñ–∞–π–ª –∞–Ω–µ–∫–¥–æ—Ç–æ–≤)
    - name: üíæ Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        if git diff --quiet; then
          echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
        else
          git add anekdots.txt published.json
          git commit -m "ü§ñ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –æ—á–µ—Ä–µ–¥–Ω–æ–π –∞–Ω–µ–∫–¥–æ—Ç [skip ci]"
          git push
        fi
